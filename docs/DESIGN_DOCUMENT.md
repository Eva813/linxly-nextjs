# Linxly NextJS - è¨­è¨ˆæ–‡ä»¶
*Design Document for Prompt Management Platform*

---

## 1. Overview æ¦‚è¿°

Linxly NextJS æ˜¯ä¸€å€‹ç¾ä»£åŒ–çš„ Prompt ç®¡ç†å¹³å°ï¼Œç‚ºä½¿ç”¨è€…æä¾›å‰µå»ºã€åˆ†äº«å’Œå”ä½œ AI Prompt çš„å®Œæ•´è§£æ±ºæ–¹æ¡ˆã€‚æœ¬æ–‡ä»¶æè¿°äº†å¹³å°çš„é«˜éšæ¶æ§‹è¨­è¨ˆã€æŠ€è¡“æ±ºç­–ä»¥åŠå¯¦ä½œæ–¹å‘ï¼Œé‡é»é—œæ³¨å¤šä½¿ç”¨è€…å”ä½œã€æ¬Šé™ç®¡ç†å’Œè·¨æ™‚å€æ”¯æ´ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## 2. Context èƒŒæ™¯èªªæ˜

### ç³»çµ±èƒŒæ™¯
ç•¶å‰ AI å·¥å…·å¿«é€Ÿæ™®åŠï¼Œä½¿ç”¨è€…éœ€è¦ç®¡ç†å¤§é‡çš„ AI Promptsï¼ŒåŒ…æ‹¬å€‹äººå‰µä½œã€åœ˜éšŠå”ä½œå’ŒçŸ¥è­˜åˆ†äº«ã€‚ç¾æœ‰è§£æ±ºæ–¹æ¡ˆç¼ºä¹å®Œå–„çš„æ¬Šé™ç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶å’Œå”ä½œåŠŸèƒ½ã€‚

### æŠ€è¡“èƒŒæ™¯
- **å‰ç«¯æ¡†æ¶**: Next.js 14 with App Router
- **ç‹€æ…‹ç®¡ç†**: Zustand with persist middleware
- **è³‡æ–™åº«**: Firebase Firestore
- **UIæ¡†æ¶**: Tailwind CSS + shadcn/ui
- **éƒ¨ç½²ç’°å¢ƒ**: Vercel

### ä½¿ç”¨è€…è§’è‰²
- **å€‹äººä½¿ç”¨è€…**: ç®¡ç†å€‹äºº Prompts å’Œè³‡æ–™å¤¾
- **åœ˜éšŠå”ä½œè€…**: åƒèˆ‡å…±äº«ç©ºé–“ï¼Œå…·æœ‰ä¸åŒæ¬Šé™ç´šåˆ¥
- **ç©ºé–“æ“æœ‰è€…**: ç®¡ç†ç©ºé–“æ¬Šé™å’Œæˆå“¡é‚€è«‹

## 3. Goals and Non-Goals ç›®æ¨™èˆ‡éç›®æ¨™

### Goals ç›®æ¨™
âœ… **æ ¸å¿ƒåŠŸèƒ½**
- å¤šå±¤ç´š Prompt çµ„ç¹” (Space â†’ Folder â†’ Prompt)
- å®Œæ•´çš„æ¬Šé™ç®¡ç†ç³»çµ± (owner/edit/view)
- å³æ™‚å”ä½œå’Œåˆ†äº«åŠŸèƒ½
- è·¨æ™‚å€æ”¯æ´å’Œæœ¬åœ°åŒ–

âœ… **æŠ€è¡“ç›®æ¨™**
- é«˜æ€§èƒ½çš„ç‹€æ…‹ç®¡ç†å’Œå¿«å–æ©Ÿåˆ¶
- å¯æ“´å±•çš„æ¶æ§‹è¨­è¨ˆ
- è‰¯å¥½çš„é–‹ç™¼è€…é«”é©—

### Non-Goals éç›®æ¨™
âŒ **æš«ä¸å¯¦ä½œ**
- AI Prompt è‡ªå‹•ç”ŸæˆåŠŸèƒ½
- è¤‡é›œçš„ç‰ˆæœ¬æ§åˆ¶ç³»çµ±
- å³æ™‚èŠå¤©åŠŸèƒ½
- æ‰‹æ©ŸåŸç”Ÿæ‡‰ç”¨

## 4. High Level Design é«˜éšè¨­è¨ˆ

### ç³»çµ±æ¶æ§‹åœ–
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Next.js App   â”‚â—„â”€â”€â–ºâ”‚  Firebase Auth  â”‚    â”‚  Vercel Deploy  â”‚
â”‚  (Client Side)  â”‚    â”‚   & Firestore   â”‚    â”‚   (CDN/Edge)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Zustand Store  â”‚    â”‚   API Routes    â”‚
â”‚  (State Mgmt)   â”‚    â”‚ (Server Side)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¶æ§‹ç¶­åº¦

#### 1. **çµæ§‹ç¶­åº¦ (Structure)**
- **åˆ†å±¤æ¶æ§‹**: Presentation â†’ Business Logic â†’ Data Access
- **æ¨¡çµ„åŒ–è¨­è¨ˆ**: æŒ‰åŠŸèƒ½åŸŸåˆ†å‰² (auth, prompts, spaces, sharing)
- **çµ„ä»¶åŒ–**: å¯é‡ç”¨çš„ UI çµ„ä»¶åº«

#### 2. **è¡Œç‚ºç¶­åº¦ (Behavior)**
- **äº‹ä»¶é©…å‹•**: ä½¿ç”¨è€…æ“ä½œè§¸ç™¼ç‹€æ…‹æ›´æ–°
- **å¿«å–ç­–ç•¥**: å¤šå±¤å¿«å– (Memory â†’ LocalStorage â†’ Database)
- **æ¬Šé™é©—è­‰**: Middleware å±¤çµ±ä¸€è™•ç†

#### 3. **äº’å‹•ç¶­åº¦ (Interaction)**
- **RESTful API**: æ¨™æº–åŒ–çš„è³‡æ–™äº¤æ›
- **å³æ™‚åŒæ­¥**: Firebase å¯¦æ™‚ç›£è½
- **æ‰¹æ¬¡æ“ä½œ**: å„ªåŒ–è³‡æ–™åº«æŸ¥è©¢æ€§èƒ½

#### 4. **è³‡è¨Šç¶­åº¦ (Information)**
- **è³‡æ–™æ¨¡å‹**: éšå±¤å¼çµæ§‹ (User â†’ Space â†’ Folder â†’ Prompt)
- **æ¬Šé™æ¨¡å‹**: RBAC (Role-Based Access Control)
- **å¿«å–ç®¡ç†**: TTL ç­–ç•¥å’Œå¤±æ•ˆæ©Ÿåˆ¶

### é—œéµçµ„ä»¶èªªæ˜

#### **å‰ç«¯çµ„ä»¶ (Client-Side)**
- **App Router**: è·¯ç”±ç®¡ç†å’Œé é¢çµ„ç¹”
- **Zustand Store**: ç‹€æ…‹ç®¡ç†ä¸­å¿ƒ
- **UI Components**: shadcn/ui åŸºç¤çµ„ä»¶ + è‡ªå®šç¾©æ¥­å‹™çµ„ä»¶

#### **å¾Œç«¯æœå‹™ (Server-Side)**
- **API Routes**: Next.js API å±¤è™•ç†æ¥­å‹™é‚è¼¯
- **Middleware**: æ¬Šé™é©—è­‰å’Œè«‹æ±‚è™•ç†
- **Firebase Admin**: ä¼ºæœå™¨ç«¯è³‡æ–™åº«æ“ä½œ

#### **åŸºç¤è¨­æ–½ (Infrastructure)**
- **Firebase**: èº«ä»½é©—è­‰ + Firestore è³‡æ–™åº«
- **Vercel**: éƒ¨ç½²å¹³å°å’Œ CDN
- **ç’°å¢ƒé…ç½®**: å¤šç’°å¢ƒæ”¯æ´ (.env.local, .env.production)

### æŠ€è¡“æ±ºç­–

#### **Next.js 14 + App Router**
- **é¸æ“‡åŸå› **: æœ€æ–°çš„ React ç”Ÿæ…‹ç³»çµ±æ”¯æ´ï¼Œå„ªç§€çš„ SSR/SSG èƒ½åŠ›
- **æ›¿ä»£æ–¹æ¡ˆ**: Remix, Vite + React Router (è¤‡é›œåº¦è¼ƒé«˜ï¼Œç”Ÿæ…‹ç³»çµ±æ”¯æ´è¼ƒå°‘)

#### **Zustand vs Redux**
- **é¸æ“‡åŸå› **: è¼•é‡åŒ–ï¼ŒTypeScript å‹å¥½ï¼Œå­¸ç¿’æ›²ç·šå¹³ç·©
- **æ›¿ä»£æ–¹æ¡ˆ**: Redux Toolkit (éæ–¼è¤‡é›œ), Jotai (ç”Ÿæ…‹ç³»çµ±è¼ƒå°)

#### **Firebase vs è‡ªå»ºå¾Œç«¯**
- **é¸æ“‡åŸå› **: å¿«é€Ÿé–‹ç™¼ï¼Œå…§å»ºèº«ä»½é©—è­‰ï¼Œå¯¦æ™‚åŒæ­¥èƒ½åŠ›
- **æ›¿ä»£æ–¹æ¡ˆ**: PostgreSQL + Node.js (é–‹ç™¼æ™‚é–“è¼ƒé•·)

## 5. Detailed Design è©³ç´°è¨­è¨ˆ

### è³‡æ–™æ¨¡å‹è¨­è¨ˆ

```typescript
// æ ¸å¿ƒè³‡æ–™çµæ§‹
interface User {
  id: string;
  email: string;
  name: string;
  createdAt: Date;
}

interface PromptSpace {
  id: string;
  name: string;
  userId: string; // owner
  defaultSpace?: boolean;
  createdAt: Date;
  updatedAt?: Date;
}

interface Folder {
  id: string;
  name: string;
  description?: string;
  promptSpaceId: string;
  prompts: Prompt[];
}

interface Prompt {
  id: string;
  title: string;
  content: string;
  folderId: string;
  createdAt: Date;
  updatedAt?: Date;
}

interface SpaceShare {
  id: string;
  promptSpaceId: string;
  ownerUserId: string;
  sharedWithUserId?: string; // null for universal links
  permission: 'view' | 'edit';
  expiresAt?: Date;
  isUniversal: boolean;
}
```

### æ¬Šé™ç³»çµ±è¨­è¨ˆ

```typescript
// æ¬Šé™å±¤ç´šå®šç¾©
type UserRole = 'owner' | 'edit' | 'view';
type SpaceAction = 'view' | 'edit' | 'share' | 'delete';

// æ¬Šé™æ˜ å°„çŸ©é™£
const ROLE_PERMISSIONS: Record<SpaceAction, UserRole[]> = {
  view: ['owner', 'edit', 'view'],
  edit: ['owner', 'edit'],
  share: ['owner'],
  delete: ['owner']
};

// ä¸­é–“ä»¶é©—è­‰æµç¨‹
export const spaceAccessMiddleware = async (
  userId: string,
  spaceId: string,
  requiredPermission?: string
): Promise<{ success: boolean; role?: UserRole; error?: string }>;
```

### ç‹€æ…‹ç®¡ç†æ¶æ§‹

```typescript
// Zustand Store çµæ§‹
interface AppState {
  // ä½¿ç”¨è€…ç‹€æ…‹
  user: UserSlice;
  
  // æ ¸å¿ƒæ¥­å‹™ç‹€æ…‹  
  promptSpaces: PromptSpaceSlice;
  folders: FolderSlice;
  prompts: PromptSlice;
  
  // UI ç‹€æ…‹
  ui: UISlice;
}

// å¿«å–ç­–ç•¥
interface CacheConfig {
  // é‚€è«‹é€£çµéæœŸ (30å¤©)
  INVITE_LINK_EXPIRES_MS: 30 * 24 * 60 * 60 * 1000;
  
  // Folder è³‡æ–™å¿«å– (5åˆ†é˜)  
  FOLDER_CACHE_MS: 5 * 60 * 1000;
  
  // JWT Token éæœŸ (7å¤©)
  JWT_EXPIRES_DAYS: 7;
}
```

## 6. Timeline æ™‚é–“è¡¨

### ç¬¬ä¸€éšæ®µï¼šæ ¸å¿ƒåŠŸèƒ½ (4é€±)
- **é€± 1-2**: åŸºç¤æ¶æ§‹æ­å»º
  - Next.js å°ˆæ¡ˆåˆå§‹åŒ–
  - Firebase è¨­å®šå’ŒåŸºç¤èªè­‰
  - åŸºæœ¬ UI çµ„ä»¶å»ºç«‹
  
- **é€± 3-4**: æ ¸å¿ƒæ¥­å‹™åŠŸèƒ½
  - Prompt å’Œ Folder ç®¡ç†
  - åŸºæœ¬çš„ CRUD æ“ä½œ
  - ç‹€æ…‹ç®¡ç†å¯¦ä½œ

### ç¬¬äºŒéšæ®µï¼šå”ä½œåŠŸèƒ½ (3é€±)
- **é€± 5-6**: æ¬Šé™ç³»çµ±
  - å¤šä½¿ç”¨è€…æ¬Šé™ç®¡ç†
  - Space åˆ†äº«æ©Ÿåˆ¶
  - å­˜å–æ§åˆ¶ä¸­é–“ä»¶
  
- **é€± 7**: é‚€è«‹ç³»çµ±
  - é‚€è«‹é€£çµç”Ÿæˆ
  - éæœŸæ©Ÿåˆ¶å’Œé©—è­‰

### ç¬¬ä¸‰éšæ®µï¼šå„ªåŒ–å’Œå®Œå–„ (1é€±)
- **é€± 8**: æ€§èƒ½å„ªåŒ–
  - å¿«å–ç­–ç•¥å¯¦ä½œ
  - æ™‚å€æ”¯æ´
  - éŒ¯èª¤è™•ç†å’Œç”¨æˆ¶é«”é©—æ”¹å–„

**æ³¨æ„**: æ­¤ç‚ºæ¨‚è§€æ™‚é–“ä¼°ç®—ï¼Œå¯¦éš›é–‹ç™¼å¯èƒ½å› éœ€æ±‚è®Šæ›´å’ŒæŠ€è¡“æŒ‘æˆ°è€Œèª¿æ•´ã€‚

## 7. Risks and Open Questions é¢¨éšªèˆ‡é–‹æ”¾å•é¡Œ

### æŠ€è¡“é¢¨éšª
ğŸ”´ **é«˜é¢¨éšª**
- **Firebase è²»ç”¨æ§åˆ¶**: å¤§é‡ä½¿ç”¨è€…å¯èƒ½å°è‡´é«˜é¡è²»ç”¨
- **å³æ™‚åŒæ­¥æ€§èƒ½**: å¤šäººå”ä½œæ™‚çš„è³‡æ–™è¡çªè™•ç†

ğŸŸ¡ **ä¸­é¢¨éšª**  
- **Next.js App Router ç©©å®šæ€§**: ç›¸å°æ–°çš„åŠŸèƒ½ï¼Œå¯èƒ½æœ‰æœªçŸ¥ bug
- **è·¨æ™‚å€è¤‡é›œæ€§**: ä¸åŒåœ°å€ä½¿ç”¨è€…çš„æ™‚é–“è™•ç†

ğŸŸ¢ **ä½é¢¨éšª**
- **UI çµ„ä»¶ç›¸å®¹æ€§**: shadcn/ui ç”Ÿæ…‹ç³»çµ±æˆç†Ÿåº¦è¼ƒé«˜

### é–‹æ”¾å•é¡Œ
â“ **å¾…è§£æ±ºå•é¡Œ**
1. **é›¢ç·šæ”¯æ´**: æ˜¯å¦éœ€è¦ PWA åŠŸèƒ½ï¼Ÿ
2. **è³‡æ–™åŒ¯å‡º**: ä½¿ç”¨è€…å¦‚ä½•å‚™ä»½å€‹äººè³‡æ–™ï¼Ÿ
3. **æœå°‹åŠŸèƒ½**: å¤§é‡ Prompt çš„æœå°‹å’Œç´¢å¼•ç­–ç•¥ï¼Ÿ
4. **åœ‹éš›åŒ–**: å¤šèªè¨€æ”¯æ´çš„å„ªå…ˆç´šï¼Ÿ

### ç·©è§£ç­–ç•¥
- **Firebase è²»ç”¨**: å¯¦ä½œæŸ¥è©¢å„ªåŒ–å’Œå¿«å–ç­–ç•¥
- **è³‡æ–™è¡çª**: æ¡ç”¨æ¨‚è§€é–å®šå’Œè¡çªè§£æ±ºæ©Ÿåˆ¶
- **ç›£æ§å‘Šè­¦**: è¨­ç½®æ€§èƒ½å’ŒéŒ¯èª¤ç›£æ§

## 8. Appendix é™„éŒ„

### ç›¸é—œæ–‡ä»¶é€£çµ
- [API æ–‡ä»¶è¦æ ¼](./api-specification.md)
- [è³‡æ–™åº« Schema](./database-schema.md)
- [éƒ¨ç½²æŒ‡å—](./deployment-guide.md)
- [æ¸¬è©¦ç­–ç•¥](./testing-strategy.md)

### æŠ€è¡“åƒè€ƒ
- [Next.js 14 å®˜æ–¹æ–‡ä»¶](https://nextjs.org/docs)
- [Firebase æ•´åˆæŒ‡å—](https://firebase.google.com/docs/web/setup)
- [Zustand ç‹€æ…‹ç®¡ç†](https://github.com/pmndrs/zustand)
- [shadcn/ui çµ„ä»¶åº«](https://ui.shadcn.com/)

### ç¨‹å¼ç¢¼ç¯„ä¾‹
- [æ¬Šé™ä¸­é–“ä»¶å¯¦ä½œ](../src/middleware/spaceAccess.ts)
- [æ™‚å€è™•ç†å·¥å…·](../src/utils/timezone.ts)
- [å¿«å–é…ç½®ç®¡ç†](../src/config/cache.ts)

---

**æ–‡ä»¶ç‰ˆæœ¬**: v1.0  
**æœ€å¾Œæ›´æ–°**: 2024-12-29  
**è² è²¬äºº**: Development Team  

---

*æ­¤è¨­è¨ˆæ–‡ä»¶ç‚ºæ´»æ–‡ä»¶ï¼Œå°‡æ ¹æ“šé–‹ç™¼é€²åº¦å’Œå›é¥‹æŒçºŒæ›´æ–°ã€‚*